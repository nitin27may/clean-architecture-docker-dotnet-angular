<div class="container mx-auto p-4">
  <div class="max-w-6xl mx-auto">
    <!-- Page Header -->
    <app-page-header
      title="User Management"
      subtitle="Manage system users and their information"
      icon="people">
    </app-page-header>

    <!-- Form Card -->
    <mat-card class="mb-6 overflow-hidden">
      <div class="bg-surface-container-high px-6 py-4 border-b border-outline-variant">
        <h2 class="text-lg font-semibold m-0 flex items-center gap-2">
          <mat-icon class="text-primary">{{ selectedUser() ? 'edit' : 'person_add' }}</mat-icon>
          {{ selectedUser() ? 'Edit User' : 'Add New User' }}
        </h2>
      </div>
      
      <mat-card-content style="padding: 0;">
        <div class="p-6 pt-8">
          <form [formGroup]="userForm" (ngSubmit)="saveUser()" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- First Name -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>First Name</mat-label>
              <input matInput formControlName="firstName" placeholder="Enter first name">
              @if (userForm.get('firstName')?.invalid && userForm.get('firstName')?.touched) {
                <mat-error>First name is required</mat-error>
              }
            </mat-form-field>

            <!-- Last Name -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Last Name</mat-label>
              <input matInput formControlName="lastName" placeholder="Enter last name">
              @if (userForm.get('lastName')?.invalid && userForm.get('lastName')?.touched) {
                <mat-error>Last name is required</mat-error>
              }
            </mat-form-field>

            <!-- Username -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Username</mat-label>
              <input matInput formControlName="userName" placeholder="Enter username">
              @if (userForm.get('userName')?.invalid && userForm.get('userName')?.touched) {
                <mat-error>Username is required</mat-error>
              }
            </mat-form-field>

            <!-- Email -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Email</mat-label>
              <input matInput formControlName="email" type="email" placeholder="Enter email">
              @if (userForm.get('email')?.invalid && userForm.get('email')?.touched) {
                <mat-error>Please enter a valid email</mat-error>
              }
            </mat-form-field>

            <!-- Mobile -->
            <mat-form-field appearance="outline" class="w-full">
              <mat-label>Mobile</mat-label>
              <input matInput formControlName="mobile" placeholder="Enter mobile number">
              @if (userForm.get('mobile')?.invalid && userForm.get('mobile')?.touched) {
                <mat-error>Mobile number is required</mat-error>
              }
            </mat-form-field>
          </div>

          <div class="flex justify-end gap-3 pt-6 mt-6 border-t border-outline-variant">
            <button 
              mat-stroked-button 
              type="button" 
              (click)="resetForm()"
              [disabled]="loading()">
              Cancel
            </button>
            <button 
              mat-flat-button 
              color="primary" 
              type="submit" 
              [disabled]="userForm.invalid || loading()">
              @if (loading()) {
                <mat-spinner diameter="20" class="inline-block mr-2"></mat-spinner>
              }
              {{ selectedUser() ? 'Update User' : 'Create User' }}
            </button>
          </div>
        </form>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- User List Card -->
    <mat-card class="overflow-hidden">
      <div class="bg-surface-container-high px-6 py-4 border-b border-outline-variant">
        <h2 class="text-lg font-semibold m-0 flex items-center gap-2">
          <mat-icon class="text-primary">list</mat-icon>
          User List
        </h2>
      </div>
      
      <mat-card-content class="p-0">
        @if (loading() && users().length === 0) {
          <div class="p-4">
            <app-skeleton type="table" [rows]="5" [columns]="6" />
          </div>
        } @else if (users().length === 0) {
          <app-empty-state
            icon="people_outline"
            title="No users found"
            description="There are no users in the system yet.">
          </app-empty-state>
        } @else {
          <div class="overflow-x-auto">
            <table mat-table [dataSource]="users()" class="w-full min-w-[800px]">
              <!-- First Name Column -->
              <ng-container matColumnDef="firstName">
                <th mat-header-cell *matHeaderCellDef class="font-semibold">First Name</th>
                <td mat-cell *matCellDef="let user">{{ user.firstName }}</td>
              </ng-container>

              <!-- Last Name Column -->
              <ng-container matColumnDef="lastName">
                <th mat-header-cell *matHeaderCellDef class="font-semibold">Last Name</th>
                <td mat-cell *matCellDef="let user">{{ user.lastName }}</td>
              </ng-container>

              <!-- Username Column -->
              <ng-container matColumnDef="userName">
                <th mat-header-cell *matHeaderCellDef class="font-semibold">Username</th>
                <td mat-cell *matCellDef="let user">{{ user.userName }}</td>
              </ng-container>

              <!-- Email Column -->
              <ng-container matColumnDef="email">
                <th mat-header-cell *matHeaderCellDef class="font-semibold">Email</th>
                <td mat-cell *matCellDef="let user">{{ user.email }}</td>
              </ng-container>

              <!-- Mobile Column -->
              <ng-container matColumnDef="mobile">
                <th mat-header-cell *matHeaderCellDef class="font-semibold">Mobile</th>
                <td mat-cell *matCellDef="let user">{{ user.mobile }}</td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef class="font-semibold text-right">Actions</th>
                <td mat-cell *matCellDef="let user" class="text-right">
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="selectUser(user)"
                    matTooltip="Edit user"
                    aria-label="Edit user">
                    <mat-icon>edit</mat-icon>
                  </button>
                  <button 
                    mat-icon-button 
                    color="warn" 
                    (click)="deleteUser(user)"
                    matTooltip="Delete user"
                    aria-label="Delete user">
                    <mat-icon>delete</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="displayedColumns()" class="bg-surface-container"></tr>
              <tr mat-row *matRowDef="let row; columns: displayedColumns();" 
                  class="hover:bg-surface-container-highest transition-colors"></tr>
            </table>
          </div>
        }
      </mat-card-content>
    </mat-card>
  </div>
</div>
